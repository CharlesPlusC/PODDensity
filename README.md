[![HitCount](https://hits.dwyl.com/CharlesPlusC/ERP_tools.svg?style=flat-square&show=unique)](http://hits.dwyl.com/CharlesPlusC/ERP_tools)

<p align="center">
  <img src="misc/UCL-logo-black.jpg" alt="University Logo" width="200"><br/>
  <img src="misc/SGNL_logo_ColouronBlack.jpg" alt="Research Group Logo" width="200">
</p>

<h3 align="center">ERP_tools</h3>

<p align="center">
    Tools to analyze the effects of radiative fluxes from the Earth on satellite trajectories.
    This repo contains tools to analyze the effects of different earth radiation pressure models on orbit propagation and orbit determination.
    Largely based on the use of Orekit.
  <br />
  <a href="https://github.com/CharlesPlusC/ERP_tools/issues">Report Bug</a>
  Â·
  <a href="https://github.com/CharlesPlusC/ERP_tools/pulls">Request Feature</a>
</p>


## Example Animations

`make_animations.py` can be used to generate several GIFs that visualize the radiative flux along a given trajectory. By default a TLE can be specified along with a start and stop date. 

Some examples:

### Combined Flux Animation
This particular animation combines both longwave and shortwave radiative fluxes at the top of the atmosphere and calculate the ensuing radiation pressure exerted by them on the satellite.
![Combined Flux Animation](output/animations/combined_flux_animation_nipy.gif)

Longwave Hourly Flux:
![Longwave Hourly Flux](output/animations/oneweb_lw_hrly_flux.gif)

Longwave Hourly Radiance at TOA:
![Longwave Hourly](output/animations/oneweb_lw_hrly.gif)

Shortwave Hourly Flux:
![Shortwave Hourly Flux](output/animations/oneweb_sw_hrly_flux.gif)

Shortwave Hourly Radiance at TOA:
![Shortwave Hourly](output/animations/oneweb_sw_hrly.gif)

## "Geiger"-style Flux Animation
These plots record the cumulative radiative flux over a given orbit. The flux is plotted onto the satellite's FOV and is integrated over the propagation time. The aim was to get an idea of whether there is any significant time-dependent effects of ERP on the spacecraft. I thought this kind of sensing was similar to a Geiger counter, hence the name.

![OneWeb 12 hour geiger plots](output/FOV_sliced_data/geiger_plots/oneweb_1/cumulative_flux_anim.gif)

## Orekit Custom CERES ERP Force Model
I have implemented an ERP force model for Orekit that uses the CERES data to calculate the radiative flux at a given satellite's position. This force model can be used to propagate a satellite's trajectory and calculate the radiative flux at each point along the trajectory.
The radiation coming out of cell of the CERES dataset is assumed to follow a lambertian distribution. The radiation is the scaled by the distance to the satellite and the angle that it leaves the Earth and arrives at the satellite. 
By default, the satellite is assumed to be a flat plate pointing down towards the Earth (although this can be modified).

HCL Position Difference between the two models relative to a trajectory with no ERP force model for a OneWeb satellite over a 48-hour period:
![Knocke vs CERES Starlink RTN](output/ERP_prop/OW_HCL_48hr.jpeg)

HCL Accelerations between the two models relative to a trajectory with no ERP force model for a OneWeb satellite over a 48-hour period:
![Knocke vs CERES Starlink](output/ERP_prop/OW_RTN_48hr.jpeg)

## Batch Least Squares OD
The contains a batch least squares orbit determination routine (I followed the one outlined in Byron Tapley's "Statistical Orbit Determination").
Orekit does offer the possibility to do this but I decided to do this as a learning exercise, and I also found it easier to be able to interface my own force models into a python-based orbit determination script than through the Orekit Java-python plugins... The residuals generated by both routines are near-identical.

## Installation

To install the ERP Tools environment and dependencies, follow these steps:

1. Clone the ERP Tools repository:
   ```bash
   git clone https://github.com/CharlesPlusC/ERP_tools.git
   cd ERP_tools

2. Create and Active the conda environment:
   ```bash
   conda env create -f erp_tools_env.yml
   conda activate erp_tools_env
   ```

## Usage

After installing and activating the environment, you can run the toolset by executing the main script:

```bash
python main.py
```

Unfortunately, the only way to download CERES data is through the [ceres.larc.nasa.gov](https://ceres-tool.larc.nasa.gov/ord-tool/jsp/SYN1degEd41Selection.jsp). You will need to create an account and download the data manually. The data should be placed in the `data` directory.

Then in `main.py` replace the path variables with the path to the downloaded data.

This will calculate and plot an animation of the combined longwave and shortwave radiative flux based on the provided satellite trajectory information (currently reads and propagates a TLE but this can easily be modified to accept any ECI ephemeris).

## Contributing
Contributions and Issues to ERP Tools are welcome.
